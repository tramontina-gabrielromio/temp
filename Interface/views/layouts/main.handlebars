<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/grafico/login.css">
    <link rel="stylesheet" href="/grafico/global.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" href="/assets/dcode.css">
    <script src="/Keyboard/Keyboard.js"></script>
    <script src="/Keyboard/Numpad.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Smart Manager 4.0 - Organizador Inteligente Tramontina</title>
    <div class="head-right" style="color: white; margin-right: 70px">
      <!--<div id="bateria" style="color: white; margin-top: 20px; margin-right: 10px"></div>-->
      <div id="wifi-show" style="color: white; margin-top: -3px"></div>
      <div id="bateria-show" style="color: white; margin-left: 15px; margin-top: 21px; width: 49px"></div>
    </div>
  </head>
  <body class="bg" onload="inicializacoes()">
     <div style="margin-top:50px"></div>
    {{>_msg}}
    {{{body}}}
    </div>
    <!--<a href="/usuarios"><button id="logout" style="display: none"></button></a>-->
  </body>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.6.0/dist/umd/popper.min.js" integrity="sha384-KsvD1yqQ1/1+IA7gi3P0tyJcT3vR+NdBTt13hSJ2lnve8agRGXTTyNaBYmCR/Nwi" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.min.js" integrity="sha384-nsg8ua9HAw1y0W1btsyWgBklPnCUAFLuTMS2G72MMONqmOymq585AcH49TLBQObG" crossorigin="anonymous"></script>
  <script type="text/javascript">
    var global = io.connect();

    //document.getElementById('wifi-show').className="wifi_semSinal"
    //document.getElementById('bateria-show').className="bateria-piscando";

    function inicializacoes(){
      atualizaBateria();
      atualizaWifi();
      startTime();
    }
    function atualizaBateria(){
      global.emit('nivelBateria');
      t=setTimeout('atualizaBateria()', 30000);//Delay para atualizar valores
    }
    function atualizaWifi(){
      global.emit('statusWifi');
      t=setTimeout('atualizaWifi()', 5000);//Delay para atualizar valores
    }
    global.on('atualizaBateria', function(data){
      //document.getElementById('bateria').innerHTML=data;
      if (data == 'carregada')
        document.getElementById('bateria-show').className="bateria-carregada";
      else if (data == 'carregando')
        document.getElementById('bateria-show').className="bateria-carregando";
      else if (data == '100%')
        document.getElementById('bateria-show').className="bateria-full";
      else if (data == '80%')
        document.getElementById('bateria-show').className="bateria-80";
      else if (data == '60%')
        document.getElementById('bateria-show').className="bateria-60";
      else if (data == '40%')
        document.getElementById('bateria-show').className="bateria-40";
      else if (data == '20%')
        document.getElementById('bateria-show').className="bateria-20";
      else
        document.getElementById('bateria-show').className="bateria-piscando";
    })
    global.on('atualizaWifi', function(data, level){
      if (data==1){
        if (level >= -60)
          document.getElementById('wifi-show').className="wifi_conectado_100";
        else if (level >= -70)
          document.getElementById('wifi-show').className="wifi_conectado_75";
        else if (level >= -80)
          document.getElementById('wifi-show').className="wifi_conectado_50";
        else
          document.getElementById('wifi-show').className="wifi_conectado_25";
      }
      else{
        document.getElementById('wifi-show').className="wifi_desconectado";
      }
    })
    global.on('logoutUsuario', function(){
      if (window.location.href!="http://localhost:8081/usuarios" && window.location.href!="http://localhost:8081/usuarios/loginblocked" && window.location.href!="http://localhost:8081/admin/atualizacao")
        //document.getElementById("logout").click();
        window.location = "/usuarios";
    })

    document.addEventListener("mousedown", (event) => {
      global.emit('screenMousedown');
    })

    function startTime(){
      var today=new Date();
      var h=today.getHours();
      var m=today.getMinutes();
      //var s=today.getSeconds();
      //adicione um zero na frente de n√∫meros<10
      m=checkTime(m);
      //s=checkTime(s);
      document.getElementById('txt').innerHTML=h+":"+m;
      t=setTimeout('startTime()', 1000);//Delay para atualizar valores
    }
    function checkTime(i){
      if (i<10){
        i="0" + i;
      }
      return i;
    }
  </script>
  <body>
    <div id="txt" class="time"></div>
  </body>
</html>

<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/grafico/admin.css">
    <div class="head-left">
      <a href="/usuarios/main"><button class="btn_home"></button></a>
    </div>
    <div class="head-right">
      <a href="/usuarios/teladesligar"><button class="btn_shutdown"></button></a>
    </div>
  </head>
  <body>
    <div class="title">Alterar usuário</div>
    <form action="/admin/edituser/buscar" method="POST" autocomplete="off">
      <div class="search-table1">
        <div class="first-column">
          <div class="search-user" autocomplete="off">
            <div>
              <div class="img"></div>
            </div>
            <div>
              <input spellcheck="false" class="use-keyboard-input" id="CampoBusca" type="text" name="userLogin"></input>
            </div>
          </div>
        </div>
        <div class="second-column">
          <button id="buscar" type="submit" class="btns">
            <p>Buscar</p>
          </button>
        </div>
      </div>
    </form>
    <div class="search-table1">
      <div class="first-column">
        <div class="userlist-edit">
          <div class="scroll" style="height: 466px">
            <table id='Tabela1'>
              {{#each usuarios}}
                <tr>
                  <td style="border-right: none">{{login}}</td>
                  <td style="border-left: none; border-right: none; color: transparent">{{nivel}}</td>
                </tr>
              {{else}}
                <h4 style="color:black" align="center">Nenhum usuário</h4>
              {{/each}}
            </table>
          </div>
        </div>
      </div>
      <div class="second-column">
        <div class="frame-user" style="margin-top:20px">
          <img [src]="srcImage" [ngStyle]="{'width': !user.image ? '80%' : 'inherit', 'height': !user.image ? 'auto' : 'inherit'}" />
        </div>
        <form action="/admin/edituser/editar" method="POST">
          <input type="hidden" name="log" id="LogEditUser">
          <button id="editaDados" type="submit" class="btns" style="margin-top:15px">
            <p>Editar</p>
          </button>
        </form>
        <form action="/admin/edituser/deletar" method="POST" style="display:none">
          <input type="hidden" name="log" id="LogDeleteUser">
          <input type="hidden" name="nivel" id="NivelDeleteUser">
          <button id="deletaDados" class="btns" style="margin-top:15px"></button>
        </form>
        <button class="btns" style="margin-top:15px" onclick="abreDialogExclusao()">
          <p>Excluir</p>
        </button>
      </div>
    </div>
    <div style="visibility: hidden" id='referencia'>{{busca}}</div>

    <dialog id="dialogConfirmaExclusao" style="background: none; border: transparent">
      <form method="dialog" >
        <div class="janela-confirmaExclusao">
          <div class="contents" style="margin-top: 40px; margin-left: 30px">
            <div class="exclusao"></div>
            <p>Tem certeza de que deseja excluir este usuário?</p>
          </div>
          <div class="contents" style="margin-top: 50px; margin-left: 180px">
            <button class="btns" onclick="confirmaExclusao()">
              <p>Confirmar</p>
            </button>
            <button class="btns" onclick="fechaDialogExclusao()">
              <p>Cancelar</p>
            </button>
          </div>
        </div>
      </form>
    </dialog>

    <script>
      var tabela = document.getElementById("Tabela1");
      var linhas = tabela.getElementsByTagName("tr");
      var auxBusca = document.getElementById("referencia").innerHTML
      document.getElementById("LogEditUser").value = "";
      document.getElementById("LogDeleteUser").value = "";
      document.getElementById("NivelDeleteUser").value = "";
      document.getElementById("CampoBusca").value = auxBusca;

      for(var i = 0; i < linhas.length; i++){
        var linha = linhas[i];
        linha.addEventListener("click", function(){
          //Adicionar ao atual
          selLinha(this, false); //Selecione apenas um
          //selLinha(this, true); //Selecione quantos quiser
        });
      }

      /**
      Caso passe true, você pode selecionar multiplas linhas.
      Caso passe false, você só pode selecionar uma linha por vez.
      **/
      function selLinha(linha, multiplos){
        if(!multiplos){
          var linhas = linha.parentElement.getElementsByTagName("tr");
          for(var i = 0; i < linhas.length; i++){
            var linha_ = linhas[i];
            linha_.classList.remove("selecionado");
          }
        }
        linha.classList.toggle("selecionado");
        var selecionado = tabela.getElementsByClassName("selecionado")[0];
        selecionado = selecionado.getElementsByTagName("td");
        document.getElementById("LogEditUser").value = selecionado[0].innerHTML;
        document.getElementById("LogDeleteUser").value = selecionado[0].innerHTML;
        document.getElementById("NivelDeleteUser").value = selecionado[1].innerHTML;
      }

      /**
      Exemplo de como capturar os dados
      **/
      var btnEditar = document.getElementById("editaDados");
      var btnDeletar = document.getElementById("deletaDados");
      //Exibe alerta caso nenhuma linha tenha sido selecionada
      /*btnEditar.addEventListener("click", function(){
        var selecionados = tabela.getElementsByClassName("selecionado");
        //Verificar se eestá selecionado
        if(selecionados.length < 1){
          alert("Nenhum usuário selecionado");
          return false;
        }
      });*/

      /*btnDeletar.addEventListener("click", function(){
        var selecionados = tabela.getElementsByClassName("selecionado");
        if(selecionados.length < 1){
          alert("Nenhum usuário selecionado");
          return false;
        }
      });*/

      function abreDialogExclusao(){
        if (document.getElementById("LogDeleteUser").value != ""){
          document.getElementById('dialogConfirmaExclusao').showModal();
        }
        else{
          document.getElementById("deletaDados").click(); //Mensagem nenhum usuário selecionado
        }
      };

      function confirmaExclusao(){
        document.getElementById("deletaDados").click();
      };

      function fechaDialogExclusao(){
        document.getElementById('dialogConfirmaExclusao').close();
      //  //location.reload();
      }
    </script>
  </body>
  <foot>
    <div class="footer">
      <a href="/admin/useroptions"><button class="btn_return"></button></a>
    </div>
  </foot>
</html>
